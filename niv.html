<!-- Only creating labels and fields in tab2 cant drag anything -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"
    />
    <style>
      .dynamic-form {
        margin-right: 20px;
      }

      .dynamic-field {
        margin-top: 20px;
      }

      input.form-control,
      select.form-select {
        width: 250px;
      }

      body {
        background-color: #f4f4f4;
      }

      .navbar {
        background-color: #3498db;
      }

      .navbar-brand,
      .nav-link {
        color: #ffffff;
      }

      .nav-tabs .nav-item .nav-link {
        color: #0080ff;
      }

      .tab-pane {
        background-color: #67a7df;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .grid {
        background-color: #67a7df;
        width: 100%;
        height: 100%;
        position: relative;
      }

      #projectForm {
        margin-left: 60px;
      }

      .draggable {
        cursor: grab;
      }

      .dragging {
        opacity: 0.5;
      }

      #projectbutton {
        margin-left: 20px;
      }

      #projectForm {
        margin-top: 10px;
        margin-left: 70px;
      }

      .nav-item {
        margin-left: 50px;
      }

      #emptyGrid {
        width: 140px;
        height: 100%;
      }
    </style>
    <title>Tabs</title>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Web components</a>
      </div>
    </nav>
    <div>
      <form id="projectForm" class="mb-3">
        <input
          id="searchInput"
          type="text"
          class="form-control mb-3"
          placeholder="Search..."
        />
        <input type="text" id="projectName" placeholder="Enter project name" />
        <button type="submit" class="btn btn-primary" id="projectbutton">
          Submit
        </button>
        <span id="successMessage" class="bg-success"></span>
        <span id="errorMessage" class="bg-danger"></span>
      </form>
    </div>
    <div class="text-white">
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a
            class="nav-link active m-3 px-5 text-dark"
            id="formCreationTab"
            data-bs-toggle="tab"
            href="#tabContent1"
            >Form creation Tab</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link m-3 px-5 text-dark"
            id="alignmentTab"
            data-bs-toggle="tab"
            href="#tabContent2"
            >Alignment Tab</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link m-3 px-5 text-dark"
            id="tab3"
            data-bs-toggle="tab"
            href="#tabContent3"
            >Tab 3</a
          >
        </li>
      </ul>
    </div>

    <div class="mt-5 mx-5 p-2 text-dark">
      <div class="tab-content" id="formsContainer">
        <div class="tab-pane fade show active" id="tabContent1">
          <div id="tabContent1Forms">
            <form class="dynamic-form" id="Form1">
              <div class="row mb-3">
                <div class="col">
                  <label for="form1-name" class="form-label">Form 1</label>
                  <input
                    type="text"
                    class="form-control"
                    id="form1-name"
                    placeholder="Form 1"
                  />
                </div>
                <div class="col">
                  <label for="form1-redirect" class="form-label">
                    Form 1 Redirect Path</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="form1-redirect"
                    placeholder="Redirect Path"
                  />
                </div>
                <div class="col mt-4">
                  <button type="button" class="btn btn-primary add-form">
                    +
                  </button>
                </div>
              </div>

              <div class="dynamic-field">
                <div class="row mb-3">
                  <div class="col">
                    <label for="form1-field1" class="form-label">
                      Form1 Field Name 1</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="form1-field1"
                      placeholder="Form1 Field Name 1"
                    />
                  </div>
                  <div class="col">
                    <label for="form1-fieldType1" class="form-label"
                      >Field Types</label
                    >
                    <select class="form-select" id="form1-fieldType1">
                      <option value="text">Varchar Field</option>
                      <option value="text">Number Field</option>
                      <option value="text">Password</option>
                      <option value="text">Select Box</option>
                      <option value="text">Number Field</option>
                      <option value="text">Email</option>
                      <option value="text">Radio Button</option>
                      <option value="text">Calc Field</option>
                      <option value="text">Check Box</option>
                      <option value="text">Image</option>
                      <option value="text">Logo</option>
                      <option value="text">Comment Box</option>
                      <option value="text">Quantity Box</option>
                      <option value="text">Button</option>
                      <option value="text">Tables</option>
                      <option value="text">Video Field</option>
                      <option value="text">File Field</option>
                      <option value="text">Audio Field</option>
                    </select>
                  </div>
                  <div class="col d-flex mt-4">
                    <div class="ms-auto">
                      <button type="button" class="btn btn-primary add-field">
                        +
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div>
            <div class="mt-4">
              <button type="button" class="btn btn-primary Submit">
                Submit
              </button>
              <button type="button" class="btn btn-danger Cancel">
                cancel
              </button>
              <button type="button" class="btn btn-secondary Reset">
                Reset
              </button>
              <button type="button" class="btn btn-success Preview">
                Preview
              </button>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="tabContent2">
          <div class="grid" id="emptyGrid"></div>
        </div>
        <div
          class="tab-pane fade"
          id="tabContent3"
          style="height: 500px; width: 1100px"
        ></div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@interactjs/interactjs@1.10.11/dist/interact.min.js"></script>

    <script>
      $(document).ready(function () {
        function generateFormHtml(formId) {
          return `
          <form class="dynamic-form" id="${formId}">
            <div class="row mb-3">
              <div class="col">
                <label for="${formId}-name" class="form-label"> ${formId}</label>
                <input type="text" class="form-control" id="${formId}-name" placeholder="${formId}">
              </div>
              <div class="col">
                <label for="${formId}-redirect" class="form-label">${formId} Redirect Path</label>
                <input type="text" class="form-control" id="${formId}-redirect" placeholder="Redirect Path">
              </div>
              <div class="col mt-4">
                <button type="button" class="btn btn-danger remove-form">-</button>
              </div>
            </div>

            <!-- Field 1-->
            <div class="dynamic-field">
              <div class="row mb-3">
                <div class="col">
                  <label for="${formId}-field1" class="form-label"> ${formId} Field Name 1</label>
                  <input type="text" class="form-control" id="${formId}-field1" placeholder="${formId} Field Name 1">
                </div>
                <div class="col">
                  <label for="${formId}-fieldType1" class="form-label">Field Types</label>
                  <select class="form-select" id="${formId}-fieldType1">
                    <option value="text">Varchar Field</option>
                    <option value="text">Number Field</option>
                    <option value="text">Password</option>
                    <option value="text">Select Box</option>
                    <option value="text">Number Field</option>
                    <option value="text">Email</option>
                    <option value="text">Radio Button</option>
                    <option value="text">Calc Field</option>
                    <option value="text">Check Box</option>
                    <option value="text">Image</option>
                    <option value="text">Logo</option>
                    <option value="text">Comment Box</option>
                    <option value="text">Quantity Box</option>
                    <option value="text">Button</option>
                    <option value="text">Tables</option>
                    <option value="text">Video Field</option>
                    <option value="text">File Field</option>
                    <option value="text">Audio Field</option>
                  </select>
                </div>
                <div class="col d-flex mt-4">
                  <div class="ms-auto">
                    <button type="button" class="btn btn-primary add-field">+</button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        `;
        }

        function addForm() {
          var existingForms = $(".dynamic-form");
          var formCounter = 1;
          existingForms.each(function () {
            var idNumber = parseInt($(this).attr("id").replace("Form", ""));
            formCounter = Math.max(formCounter, idNumber + 1);
          });
          var newFormId = "Form" + formCounter;
          var newFormHtml = generateFormHtml(newFormId);
          $("#tabContent1Forms").append(newFormHtml);
        }

        function removeForm() {
          $(this).closest(".dynamic-form").remove();
        }

        function addField(formId) {
          var existingFields = $("#" + formId + " .dynamic-field").length;
          var maxFieldNumber = 1;

          $("#" + formId + " .dynamic-field").each(function () {
            var id = $(this).find("input").attr("id");
            var fieldNumber = parseInt(id.split("Field")[1]);
            if (!isNaN(fieldNumber) && fieldNumber > maxFieldNumber) {
              maxFieldNumber = fieldNumber;
            }
          });

          var nextFieldNumber = maxFieldNumber + 1;

          var newField = `
          <div class="dynamic-field">
            <div class="row mb-3">
              <div class="col">
                <label for="${formId}-Field${nextFieldNumber}" class="form-label"> ${formId} Field Name ${nextFieldNumber}</label>
                <input type="text" class="form-control" id="${formId}-Field${nextFieldNumber}" placeholder="${formId} Field Name ${nextFieldNumber}">
              </div>
              <div class="col">
                <label for="${formId}-fieldType${nextFieldNumber}" class="form-label">Field Types</label>
                <select class="form-select" id="${formId}-fieldType${nextFieldNumber}">
                  <option value="text">Varchar Field</option>
                  <option value="text">Number Field</option>
                  <option value="text">Password</option>
                  <option value="text">Select Box</option>
                  <option value="text">Number Field</option>
                  <option value="text">Email</option>
                  <option value="text">Radio Button</option>
                  <option value="text">Calc Field</option>
                  <option value="text">Check Box</option>
                  <option value="text">Image</option>
                  <option value="text">Logo</option>
                  <option value="text">Comment Box</option>
                  <option value="text">Quantity Box</option>
                  <option value="text">Button</option>
                  <option value="text">Tables</option>
                  <option value="text">Video Field</option>
                  <option value="text">File Field</option>
                  <option value="text">Audio Field</option>
                  
                </select>
              </div>
              <div class="col d-flex mt-4">
                <div class="ms-auto">
                  <button type="button" class="btn btn-danger remove-field">-</button>
                </div>
              </div>
            </div>
          </div>`;

          $("#" + formId).append(newField);
        }

        function removeField() {
          $(this).closest(".dynamic-field").remove();
        }
        function resetFields(formContainerId) {
          $("#" + formContainerId + " .dynamic-form:not(:first)").remove();

          $(
            "#" + formContainerId + " .dynamic-form:first input[type='text']"
          ).val("");

          $(
            "#" + formContainerId + " .dynamic-form .dynamic-field:not(:first)"
          ).remove();

          formCounter = 1;
        }

        $(document).ready(function () {
          $("#projectForm").submit(function (e) {
            e.preventDefault();
            var projectName = $("#projectName").val();
            $.ajax({
              type: "POST",
              url: "/save_project/",
              data: {
                project_name: projectName,
                csrfmiddlewaretoken: "{{ csrf_token }}",
              },
              success: function (response) {
                $("#errorMessage")
                  .removeClass("bg-danger")
                  .addClass("bg-success")
                  .text(response.message);
                $("#projectName").val("");
                setTimeout(function () {
                  $("#errorMessage").removeClass("bg-success").text("");
                }, 2000);
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
              },
            });
          });
          $("#projectName").blur(function () {
            var projectName = $(this).val();
            $.ajax({
              type: "POST",
              url: "/validate_project_name/",
              data: {
                project_name: projectName,
                csrfmiddlewaretoken: "{{ csrf_token }}",
              },
              success: function (response) {
                if (response.exists) {
                  $("#errorMessage")
                    .removeClass("bg-success")
                    .addClass("bg-danger")
                    .text("Project name already used!");
                } else {
                  $("#errorMessage")
                    .removeClass("bg-danger bg-success")
                    .text("");
                }
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
              },
            });
          });
        });
        $("#searchInput").on("keyup", function () {
          var value = $(this).val().toLowerCase();
          $(".dynamic-form").filter(function () {
            $(this).toggle(
              $(this).attr("id").toLowerCase().indexOf(value) > -1
            );
          });
        });
        $(".Preview").click(function () {
          $('a[href="#tabContent2"]').tab("show");

          $("#emptyGrid").empty();

          $("#tabContent1Forms .dynamic-form").each(function () {
            var formName = $(this).find('input[id$="-name"]').val();
            var redirectPath = $(this).find('input[id$="-redirect"]').val();
            var formHtml = "";
            var labelHtml = `<div style="margin-bottom: 15px;" class="label label-large">${formName} </div>`;
            formHtml += labelHtml;

            $(this)
              .find(".dynamic-field")
              .each(function () {
                var fieldName = $(this).find('input[type="text"]').val();
                var selectedOption = $(this)
                  .find("select option:selected")
                  .text();
                formHtml += `<div style="margin-bottom: 15px;">${fieldName}</div>`;
                formHtml += `<input type="text" class="form-control" value="${selectedOption}" placeholder="Selected Value" style="margin-bottom: 15px;">`;
              });

            $("#emptyGrid").append(formHtml);
          });
        });
        $(".Preview").click(function () {
          // Switch to the Alignment Tab
          $('a[href="#tabContent2"]').tab("show");

          // Clear existing content in the Alignment Tab
          $("#emptyGrid").empty();

          // Get data from Form 1 and create labels and field data
          $("#tabContent1Forms .dynamic-form").each(function () {
            var formName = $(this).find('input[id$="-name"]').val();
            var redirectPath = $(this).find('input[id$="-redirect"]').val();
            var formHtml = ""; // Initialize variable to store form HTML

            // Construct HTML for labels
            var labelHtml = `<div class="draggable-container" style="margin-bottom: 15px;"><div class="draggable-label">${formName} ${redirectPath}</div></div>`;
            formHtml += labelHtml;

            // Iterate over each field in the form
            $(this)
              .find(".dynamic-field")
              .each(function () {
                var fieldName = $(this).find('input[type="text"]').val(); // Retrieve value of text input

                // Retrieve selected option from dropdown
                var selectedOption = $(this)
                  .find("select option:selected")
                  .text();

                // Append field name and selected option as separate draggable containers
                formHtml += `<div class="draggable-container" style="margin-bottom: 15px;"><div class="draggable-label">${fieldName}</div></div>`;
                formHtml += `<div class="draggable-container" style="margin-bottom: 15px;"><div class="draggable-input"><input type="text" class="form-control" value="${selectedOption}" placeholder="Selected Value" style="margin-bottom: 15px;"></div></div>`;
              });

            // Append form HTML to the grid
            $("#emptyGrid").append(formHtml);
          });

          // Initialize draggable functionality after appending elements
          makeDraggable();
        });

        // Function to initialize draggable functionality
        function makeDraggable() {
          $(".draggable-container").draggable({
            containment: "#emptygrid", // Limit dragging within the grid
            scroll: false, // Disable scrolling while dragging
            snap: "#emptyGrid", // Snap to grid
            snapMode: "inner", // Snap only when completely inside the grid
          });
        }
        $(".Reset").click(function () {
          resetFields("formsContainer");
        });

        $("#tabContent1").on("click", ".add-form", addForm);
        $("#formsContainer").on("click", ".remove-form", removeForm);
        $("#tabContent1").on("click", ".add-field", function () {
          var formId = $(this).closest(".dynamic-form").attr("id");
          addField(formId);
        });
        $("#tabContent1").on("click", ".remove-field", removeField);
      });
    </script>
  </body>
</html>
